JavaNet 在线购物网站 - 完整部署指南

项目概述
这是一个基于 Java Web 技术栈的电商购物网站，采用以下技术：
后端: Java 8 + Servlet + JSP + JDBC
数据库: MySQL 8.0
前端: HTML5 + CSS3 + JavaScript
支付: Stripe 国际信用卡支付
构建工具: Maven
应用服务器: 内嵌 Tomcat 7（通过 Maven 插件）

一、环境准备

1.1 系统要求
操作系统: Linux (推荐 Ubuntu/CentOS) 或 Windows/macOS
JDK: 8 或更高版本
MySQL: 8.0+
Maven: 3.6+

1.2 安装依赖（以 Ubuntu 为例）
更新系统
sudo apt update && sudo apt upgrade -y
安装 JDK 8
sudo apt install openjdk-8-jdk -y
安装 MySQL
sudo apt install mysql-server -y
安装 Maven
sudo apt install maven -y
验证安装
java -version
mysql --version
mvn -version

1.3 安装依赖（以 CentOS/RHEL 为例）
安装 JDK 8
sudo yum install java-1.8.0-openjdk-devel -y
安装 MySQL
sudo yum install mysql-server -y
sudo systemctl start mysqld
sudo systemctl enable mysqld
安装 Maven
sudo yum install maven -y

1.4 安装依赖（以 macOS 为例）
使用 Homebrew 安装
brew install openjdk@8
brew install mysql
brew install maven
启动 MySQL
brew services start mysql

二、数据库配置

2.1 启动 MySQL 服务
Linux:
sudo systemctl start mysql
sudo systemctl enable mysql
macOS:
brew services start mysql
检查状态:
sudo systemctl status mysql

2.2 初始化数据库
数据库初始化脚本位于 database/init.sql，包含：
- 创建数据库 javanet_shop（使用 UTF-8 字符集）
- 创建 9 张核心表：
  users - 用户表
  products - 商品表
  orders - 订单表
  order_items - 订单详情表
  cart - 购物车表
  product_images - 商品图片表
  customer_browse_logs - 客户浏览日志表
  customer_purchase_stats - 客户购买统计表
  product_reviews - 商品评价表
- 插入测试数据（用户、商品、浏览记录等）
- 创建性能优化索引
执行数据库初始化:
mysql -u root -p < database/init.sql

2.3 创建数据库用户
根据项目配置，需要创建专用数据库用户：
登录 MySQL
mysql -u root -p
创建专用用户
CREATE USER 'javanet_user'@'localhost' IDENTIFIED BY 'JavaNet123!';
授权
GRANT ALL PRIVILEGES ON javanet_shop.* TO 'javanet_user'@'localhost';
FLUSH PRIVILEGES;
验证用户创建成功
SELECT User, Host FROM mysql.user WHERE User = 'javanet_user';
退出
EXIT;

2.4 数据库连接配置
数据库连接参数在 src/main/java/com/javanet/util/DatabaseConnection.java：
参数          默认值
URL           jdbc:mysql://localhost:3306/javanet_shop
用户名        javanet_user
密码          JavaNet123!
字符集        UTF-8
时区          Asia/Shanghai
如需修改数据库连接信息，编辑该文件中的常量：
private static final String URL = "jdbc:mysql://localhost:3306/javanet_shop?useUnicode=true&characterEncoding=UTF-8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true";
private static final String USERNAME = "javanet_user";
private static final String PASSWORD = "JavaNet123!";

2.5 验证数据库连接
使用创建的用户登录测试
mysql -u javanet_user -p'JavaNet123!' javanet_shop
查看表
SHOW TABLES;
查看测试用户
SELECT id, username, role FROM users;

三、Stripe 支付配置

3.1 获取 Stripe 密钥
1. 访问 Stripe Dashboard: https://dashboard.stripe.com/
2. 注册/登录账号
3. 进入 Developers > API keys
4. 获取测试密钥：
   Publishable key (以 pk_test_ 开头)
   Secret key (以 sk_test_ 开头)

3.2 配置 Stripe 密钥
项目支持两种配置方式（优先级：环境变量 > .env 文件）：
方式一：环境变量（推荐生产环境）
临时设置（当前会话有效）
export STRIPE_PUBLISHABLE_KEY=pk_test_xxx
export STRIPE_SECRET_KEY=sk_test_xxx
永久设置（添加到 ~/.bashrc 或 ~/.profile）
echo 'export STRIPE_PUBLISHABLE_KEY=pk_test_xxx' >> ~/.bashrc
echo 'export STRIPE_SECRET_KEY=sk_test_xxx' >> ~/.bashrc
source ~/.bashrc
方式二：.env 文件（开发环境）
复制示例文件
cp .env.example .env
编辑 .env 文件
nano .env
.env 文件内容：
STRIPE_PUBLISHABLE_KEY=pk_test_your_publishable_key_here
STRIPE_SECRET_KEY=sk_test_your_secret_key_here
安全提示：
- .env 文件已在 .gitignore 中，不会被提交到版本控制
- 生产环境请使用环境变量，不要将密钥硬编码
- 测试密钥仅用于开发测试，生产环境需使用正式密钥

四、项目构建与启动

4.1 项目结构
javanet/
├── pom.xml                 Maven 配置文件
├── .env.example            环境变量示例
├── restart-server.sh       启动脚本
├── stop-server.sh          停止脚本
├── database/
│   └── init.sql            数据库初始化脚本
└── src/
    └── main/
        ├── java/           Java 源代码
        │   └── com/javanet/
        │       ├── dao/    数据访问层
        │       ├── model/  实体类
        │       ├── service/业务逻辑层
        │       ├── servlet/控制器
        │       ├── filter/ 过滤器
        │       └── util/   工具类
        └── webapp/         Web 资源
            ├── css/        样式文件
            ├── js/         JavaScript
            ├── images/     图片资源
            └── WEB-INF/
                ├── web.xml Web 配置
                └── views/  JSP 视图

4.2 Maven 配置说明
根据 pom.xml 配置：
配置项        值
打包方式      WAR
最终名称      javanet-shop
Java 版本     8
运行端口      1337
绑定地址      0.0.0.0（允许外部访问）

4.3 核心依赖
依赖                    版本      用途
javax.servlet-api       4.0.1     Servlet API
jsp-api                 2.2       JSP 支持
jstl                    1.2       JSP 标签库
mysql-connector-java    8.0.33    MySQL 驱动
gson                    2.10.1    JSON 处理
javax.mail              1.6.2     邮件发送
stripe-java             24.3.0    Stripe 支付

4.4 使用启动脚本（推荐）
restart-server.sh 脚本执行以下操作：
1. 停止现有 Tomcat 进程
2. 执行 mvn clean package 编译打包
3. 使用 nohup mvn tomcat7:run 后台启动
4. 将日志输出到 /root/javanet/server.log
5. 保存进程 PID 到 /root/javanet/server.pid
添加执行权限
chmod +x restart-server.sh
chmod +x stop-server.sh
启动服务
./restart-server.sh
启动成功后会显示：
==========================================
服务器已在后台启动！
进程ID: xxxxx
日志文件: /root/javanet/server.log
常用命令：
  查看日志: tail -f /root/javanet/server.log
  停止服务: pkill -f 'tomcat7:run'
  查看状态: ps aux | grep tomcat7
==========================================
服务器启动成功，正在运行中...

4.5 手动启动
仅编译（不启动）
mvn clean compile
编译并打包
mvn clean package
启动 Tomcat（前台运行，Ctrl+C 停止）
mvn tomcat7:run
后台运行
nohup mvn tomcat7:run > server.log 2>&1 &

4.6 停止服务
方式一：使用脚本
./stop-server.sh
方式二：使用命令
pkill -f "tomcat7:run"
方式三：根据 PID 停止
kill $(cat /root/javanet/server.pid)

4.7 查看日志
实时查看日志
tail -f /root/javanet/server.log
查看最后 100 行
tail -100 /root/javanet/server.log
搜索错误信息
grep -i "error" /root/javanet/server.log

五、网络配置（公网部署）

5.1 防火墙配置
Ubuntu/Debian (UFW):
开放端口
sudo ufw allow 1337/tcp
sudo ufw allow 22/tcp
启用防火墙
sudo ufw --force enable
查看状态
sudo ufw status
CentOS/RHEL (firewalld):
开放端口
sudo firewall-cmd --permanent --add-port=1337/tcp
sudo firewall-cmd --permanent --add-port=22/tcp
重载配置
sudo firewall-cmd --reload
查看状态
sudo firewall-cmd --list-all

5.2 云服务器安全组配置
在云服务商控制台（阿里云、腾讯云、AWS 等）添加入站规则：
端口      协议      来源              说明
1337      TCP       0.0.0.0/0         Web 服务
22        TCP       你的IP/0.0.0.0/0  SSH 访问
3306      TCP       127.0.0.1         MySQL（仅本地）
安全提示：
- MySQL 端口 3306 不建议对外开放
- SSH 端口建议限制来源 IP
- 生产环境建议使用 HTTPS（端口 443）

5.3 域名配置（可选）
如果有域名，可以配置 DNS 解析：
1. 在域名服务商添加 A 记录，指向服务器公网 IP
2. 配置 Nginx 反向代理（推荐）
Nginx 反向代理配置示例：
server {
    listen 80;
    server_name your-domain.com;
    location / {
        proxy_pass http://127.0.0.1:1337;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}

六、验证部署

6.1 检查服务状态
查看进程
ps aux | grep tomcat7
查看端口监听
netstat -tlnp | grep 1337
或
ss -tlnp | grep 1337
查看日志
tail -f /root/javanet/server.log

6.2 测试访问
本地测试
curl -I http://localhost:1337
公网测试
curl -I http://你的公网IP:1337
正常响应：
HTTP/1.1 302 Found
Location: /home

6.3 浏览器访问
本地访问: http://localhost:1337
公网访问: http://你的公网IP:1337/home

6.4 测试账号
角色      用户名      密码          权限
管理员    admin       admin123      全部权限
卖家      seller1     seller123     商品管理、订单管理
卖家      seller2     seller123     商品管理、订单管理
买家      buyer1      buyer123      购物、下单
买家      buyer2      buyer123      购物、下单

七、部署流程总结

JavaNet 部署流程：
1. 环境准备
   安装 JDK 8 + MySQL 8.0 + Maven 3.6
2. 数据库配置
   启动 MySQL 服务
   执行 database/init.sql 初始化
   创建用户 javanet_user 并授权
3. 支付配置（可选）
   配置 Stripe 密钥（.env 或环境变量）
4. 项目启动
   执行 ./restart-server.sh
5. 网络配置（公网部署）
   开放防火墙端口 1337
   配置云服务器安全组
6. 验证访问
   访问 http://IP:1337/home

八、常见问题排查

8.1 数据库相关
问题              可能原因              解决方案
连接被拒绝        MySQL 服务未启动      sudo systemctl start mysql
访问被拒绝        用户名/密码错误       检查 DatabaseConnection.java 配置
数据库不存在      未执行初始化脚本      mysql -u root -p < database/init.sql
字符编码问题      字符集不匹配          确保数据库使用 utf8mb4

8.2 服务启动相关
问题              可能原因              解决方案
编译失败          JDK 版本不对          确保使用 JDK 8
依赖下载失败      网络问题              配置 Maven 镜像源
端口被占用        其他进程占用 1337     lsof -i:1337 查看并结束进程
启动后立即退出    配置错误              查看 server.log 日志

8.3 网络访问相关
问题              可能原因              解决方案
无法访问          防火墙未开放          开放 1337 端口
连接超时          安全组未配置          在云控制台添加入站规则
本地可访问公网不行 绑定地址问题         确保绑定 0.0.0.0

8.4 支付相关
问题                  可能原因              解决方案
Stripe 密钥未配置     .env 文件不存在       复制 .env.example 为 .env
支付失败              密钥错误              检查密钥是否正确
测试卡无效            使用了正式密钥        开发环境使用 test 密钥

8.5 查看详细错误
查看完整日志
cat /root/javanet/server.log
查看最近的错误
grep -A 5 "ERROR\|Exception" /root/javanet/server.log | tail -50
实时监控错误
tail -f /root/javanet/server.log | grep --line-buffered "ERROR\|Exception"

九、生产环境建议

9.1 安全加固
1. 修改默认密码：更改数据库用户密码和测试账号密码
2. 使用 HTTPS：配置 SSL 证书，使用 Nginx 反向代理
3. 限制访问：SSH 端口限制来源 IP
4. 定期备份：设置数据库自动备份

9.2 性能优化
1. JVM 参数调优：根据服务器内存调整堆大小
2. 数据库连接池：考虑使用 HikariCP 等连接池
3. 静态资源 CDN：将图片等静态资源放到 CDN

9.3 监控运维
1. 日志管理：配置日志轮转，避免日志文件过大
2. 进程监控：使用 systemd 或 supervisor 管理进程
3. 健康检查：配置定时检查服务状态

十、联系与支持

如有问题，请查看：
项目日志：/root/javanet/server.log
数据库日志：/var/log/mysql/error.log
系统日志：/var/log/syslog
在线演示地址：http://110.41.45.40:1337/home